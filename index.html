<!DOCTYPE html>
<html lang="en">



<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no">
	<title>Document</title>
	<style>
		body {
			width: 100vw;
			height: 100vh;
			overflow: hidden;
			background-color: #000000;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.play-screen {
			position: absolute;
			width: 1200px;
			height: 650px;
			background-color: #fff;
		}
		#canvas {
			position: absolute;
			background-color: blue;
			background: linear-gradient(to bottom, blue 0%, #77ddff 100%);
		}
		.before-play {
			position: absolute;
			width: 100%;
			height: 100%;

			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}
		.txt {
			background-color: #fff;
			width: 600px;
			height: 400px;
		}
		.button {
			padding: 0;
			border: none;
			font: inherit;
			color: inherit;
			background-color: transparent;
			cursor: pointer;

			width: 410px;
			height: 150px;

			background-image: url('./assets/start.png');
			background-size: 100%;
			background-repeat: no-repeat;


		}
		.loader {
			position: absolute;
			width: 100%;
			height: 100%;
			background-image: url(./assets/loader.jpg);
			background-size: 100%;
		}
		.loader__progress {
			position: absolute;
			top: 38%;
			left: 32%;
			height: 229px;
		}
		.loader__progress_empty {
			position: absolute;
			width: 470px;
			background-image: url(./assets/empty.png);
		}
		.loader__progress_full {
			position: absolute;
			width: 0;
			overflow: hidden;
			background-image: url(./assets/full.png);
			transition: width 2s 1s;
		}
		.loader__progress_full-ready {
			position: absolute;
			width: 470px;
			overflow: hidden;
			background-image: url(./assets/full.png);
			transition: width 2s 1s;
		}
	</style>
</head>



<body>
	<div class="play-screen">
		<canvas id="canvas" width="1200" height="650"></canvas>
		<div class="before-play">
			<div class="txt"></div>
			<button class="button"></button>
		</div>
		<div class="loader">
			<div class="loader__progress loader__progress_empty"></div>
			<div class="loader__progress loader__progress_full"></div>
	</div>



	<script>
		window.onload = LoadGame;
		function LoadGame() {
			document.querySelector('.loader__progress_full').classList.add('loader__progress_full-ready')
			var loadTimeOut = setTimeout(function() {
				document.querySelector('.loader').remove();
				clearTimeout(loadTimeOut)
			}, 2500)
		}
		document.querySelector('.button').addEventListener('click', StartGame, false)
		function StartGame() {
			document.querySelector('.before-play').remove();
		}
		var playScreen = document.querySelector('.play-screen');
		var canvas = document.querySelector('#canvas');
		ctx = canvas.getContext('2d');
		window.addEventListener('resize', Resize, false);
		Resize();
		function Resize() {
			var
				w = window.innerWidth,
				h = window.innerHeight,
				scale;
			if ((w / h) < (1200 / 800)) {
				scale = w / 1200

			} else {
				scale = h / 800
			}
			playScreen.style.transform = 'scale(' + scale + ')'
		}

		var
			student = new Image,
			zachet = new Image,
			kursach = new Image,
			snow1 = new Image,
			snow3 = new Image,
			tree1 = new Image,
			tree2 = new Image,
			tree3 = new Image,
			samolet = new Image;
		student.src = './assets/stud.png';
		zachet.src = './assets/zachet.png';
		kursach.src = './assets/kursach.png';
		snow1.src = './assets/snow1.png';
		snow3.src = './assets/snow3.png';
		tree1.src = './assets/tree1.png';
		tree2.src = './assets/tree2.png';
		tree3.src = './assets/tree3.png';
		samolet.src = './assets/samolet.png';

		var lvl = 600,
			// sizes ---------------------------
			studentW = 249 / 1.75,
			studentH = 251 / 1.75,

			zachetW = 402 / 2,
			zachetH = 319 / 2,
			kursachW = 404 / 2,
			kursachH = 346 / 2,

			snow1W = 3310,
			snow1H = 150,
			snow3W = 601,
			snow3H = 37,

			tree1W = 154/1.3,
			tree1H = 251/1.3,
			tree2W = 73/1.3,
			tree2H = 251/1.3,
			tree3W = 191/1.3,
			tree3H = 206/1.3,

			samoletW = 3030 / 15,
			samoletH = 2238 / 15,
			// coordinates ---------------------------
			studentX = 50,
			studentY = lvl - studentH,

			zachetX = 1200,
			zachetY = lvl - zachetH,
			kursachX = 1200,
			kursachY = lvl - kursachH,
			
			snow1X = 0,
			snow1X2 = snow1X + snow1W,
			snow1Y = 700 - snow1H,
			snow3X = 0,
			snow3X2 = snow3X + snow3W,
			snow3X3 = snow3X + snow3W * 2,
			snow3Y = lvl - snow3H,

			wood1X = 20,
			wood1Y = lvl + 20 - tree1H,
			wood2X = 400,
			wood2Y = lvl + 20 - tree2H,
			wood3X = 800,
			wood3Y = lvl + 20 - tree3H,

			wood4X = 1000,
			wood4Y = lvl - 60 - tree1H,
			wood5X = 700,
			wood5Y = lvl - 60 - tree2H,
			wood6X = 100,
			wood6Y = lvl - 60 - tree3H,

			wood7X = 900,
			wood7Y = lvl - 90 - tree1H,
			wood8X = 1100,
			wood8Y = lvl - 90 - tree2H,
			wood9X = -20,
			wood9Y = lvl - 90 - tree3H,

			samoletX = 1200,
			samoletY = 30;

		draw();
		var
			jumpCount		= 0,
			firstJumpEnd	= 0,
			timeJump		= 0,
			t				= 0,
			jumpVelocity	= 90;
		document.addEventListener('click', Jump, false)


		function draw() {
			//Очистить канвас
			ctx.clearRect(0, 0, 1200, 800);
			//Слой 1
			ctx.drawImage(tree1, wood1X, wood1Y, tree1W, tree1H);
			ctx.drawImage(tree2, wood2X, wood2Y, tree2W, tree2H);
			ctx.drawImage(tree3, wood3X, wood3Y, tree3W, tree3H);
			//Слой 2
			ctx.drawImage(snow3, snow3X, snow3Y, snow3W, snow3H);
			ctx.drawImage(snow3, snow3X2, snow3Y, snow3W, snow3H);
			ctx.drawImage(snow3, snow3X3, snow3Y, snow3W, snow3H);
			//Слой 3
			ctx.drawImage(tree1, wood4X, wood4Y, tree1W * 1.6, tree1H * 1.6);
			ctx.drawImage(tree2, wood5X, wood5Y, tree2W * 1.6, tree2H * 1.6);
			// ctx.drawImage(tree3, wood6X, wood6Y, tree3W * 1.1, tree3H * 1.1);
			//Слой 4
			ctx.fillStyle = '#dddddd';
			ctx.fillRect(-1, 600, 1202, 101);
			ctx.strokeRect(-1, 600, 1202, 101);
			ctx.drawImage(student, studentX, studentY, studentW, studentH);
			ctx.drawImage(zachet, zachetX, zachetY, zachetW, zachetH);
			ctx.drawImage(kursach, kursachX, kursachY, kursachW, kursachH);
			ctx.drawImage(samolet, samoletX, samoletY, samoletW, samoletH);
			//Слой 5
			ctx.drawImage(tree1, wood7X, wood7Y, tree1W * 2, tree1H * 2);
			// ctx.drawImage(tree2, wood8X, wood8Y, tree2W * 1.2, tree2H * 1.2);
			ctx.drawImage(tree3, wood9X, wood9Y, tree3W * 2, tree3H * 2);
			//Слой 6
			ctx.drawImage(snow1, snow1X, snow1Y, snow1W, snow1H);
			ctx.drawImage(snow1, snow1X2, snow1Y, snow1W, snow1H);

			moveAll();

			requestAnimationFrame(draw);
		}


		function moveAll() {
			wood1X	= (wood1X <= -300? 1200: wood1X - 3);
			wood2X	= (wood2X <= -300? 1200: wood2X - 3);
			wood3X	= (wood3X <= -300? 1200: wood3X - 3);
			wood4X	= (wood4X <= -300? 1200: wood4X - 5);
			wood5X	= (wood5X <= -300? 1200: wood5X - 5);
			wood6X	= (wood6X <= -300? 1200: wood6X - 5);
			wood7X	= (wood7X <= -300? 1200: wood7X - 9);
			wood8X	= (wood8X <= -300? 1200: wood8X - 9);
			wood9X	= (wood9X <= -300? 1200: wood9X - 9);

			snow3X	= (snow3X <= -snow3W?	snow3X3 + snow3W - 3: snow3X - 3);
			snow3X2	= (snow3X2 <= -snow3W?	snow3X + snow3W: snow3X2 - 3);
			snow3X3	= (snow3X3 <= -snow3W?	snow3X2 + snow3W: snow3X3 - 3);

			snow1X	= (snow1X <= -snow1W? snow1X2 + snow1W - 11: snow1X - 11);
			snow1X2	= (snow1X2 <= -snow1W? snow1X + snow1W: snow1X2 - 11);

			timeJump = timeJump + t;
			if(jumpCount === 1) {
				studentY	= ((456 - (jumpVelocity * timeJump) + (20 * timeJump * timeJump / 2)));
			} else if(jumpCount === 2) {
				studentY	= ((firstJumpEnd - (jumpVelocity * timeJump) + (20 * timeJump * timeJump / 2)))
			}
			if(studentY > 457) {
				timeJump = 0;
				t = 0;
				studentY = 456;
				jumpCount = 0;
			}

			console.log(studentY)
		}

		function Jump() {
			if (jumpCount < 2) {
				t = 0.16;
				jumpCount++;
				if(jumpCount === 2) {
					timeJump = 0;
					firstJumpEnd = studentY
				}
			}
		}

	</script>
</body>

</html>